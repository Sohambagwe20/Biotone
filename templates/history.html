<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood History</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
</head>
<body>

    <div class="container">
        <h1>ğŸ§  Bio-Tone</h1>
        <p class="subtitle">Your mood history</p>

        {% if entries %}

        <div class="chart-box">
            <p class="chart-title">ğŸ“Š Your Stress Trend</p>
            <canvas id="moodChart"></canvas>
        </div>

        <script>
            const labels = {{ dates | tojson }};
            const data = {{ scores | tojson }};

            const ctx = document.getElementById('moodChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Stress Score',
                        data: data,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2.5,
                        pointBackgroundColor: data.map(v =>
                            v >= 2 ? '#fc8181' :
                            v === 1 ? '#f6ad55' : '#68d391'
                        ),
                        pointRadius: 5,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const val = context.parsed.y;
                                    if (val >= 2) return 'ğŸ˜Ÿ High Stress';
                                    if (val === 1) return 'ğŸ˜ Moderate';
                                    return 'ğŸ˜Š Low Stress';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            min: -0.2,
                            max: 2.2,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) {
                                    if (value === 0) return 'ğŸ˜Š Low';
                                    if (value === 1) return 'ğŸ˜ Mid';
                                    if (value === 2) return 'ğŸ˜Ÿ High';
                                }
                            },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { maxRotation: 45, font: { size: 11 } }
                        }
                    }
                }
            });
        </script>

        {% for entry in entries %}
        <div class="history-card">
            <p class="history-date">{{ entry.date }}</p>
            <p class="history-text">"{{ entry.text }}"</p>
            <p class="history-mood">{{ entry.mood }}</p>
            <p class="history-level">{{ entry.level }}</p>
            {% if entry.note %}
            <p class="history-note">ğŸ““ {{ entry.note }}</p>
            {% endif %}
        </div>
        {% endfor %}

        {% else %}
            <p class="empty">No entries yet. Start by analyzing your mood!</p>
        {% endif %}

        <a href="/" class="back-btn">â† Back to Home</a>
    </div>

</body>
</html>